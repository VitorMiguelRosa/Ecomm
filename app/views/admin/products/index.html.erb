<% content_for :title, "Products" %>
<div class="w-full max-w-7xl mx-auto p-0 sm:px-2 lg:px-8">
  <!-- Header Section -->
  <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between mb-8 space-y-4 lg:space-y-0">
    <div class="flex flex-col items-center lg:items-start">
      <h1 class="font-bold text-3xl sm:text-4xl text-(--cor-logo) mb-4">Products</h1>
      <%= link_to "New product", new_admin_product_path, class: "rounded-md px-4 py-2.5 bg-(--cor-logo) hover:bg-(--cor-logo-hover) text-white font-medium transition-colors" %>
    </div>
    <!-- Search Section -->
    <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2">
      <%= form_with url: admin_products_path, method: :get, class: "search-form flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2" do |form|%>
        <%= form.text_field :query, placeholder: "Search products...", class: "border border-(--cor-logo) rounded-md p-2 w-full sm:w-auto", value: params[:query] %>
        <div class="flex space-x-2">
          <%= form.submit "Search", class: "bg-(--cor-logo) text-white px-4 py-2 rounded hover:bg-(--cor-logo-hover) cursor-pointer transition-colors" %>
          <%= link_to "Clear", admin_products_path, class: "bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 transition-colors" %>
        </div>
      <% end %>
    </div>
  </div>
  <!-- Products Section -->
  <% if @admin_products.any? %>
    <div class="bg-white shadow-lg rounded-lg overflow-hidden">
      <!-- Mobile Cards (visible on small/medium screens) -->
      <div class="admin-table-mobile xl:hidden">
        <% @admin_products.each do |p| %>
          <div class="mobile-card border-b border-gray-200 p-3">
            <div class="flex flex-col space-y-2">
              <!-- Product Name -->
              <h3 class="text-base font-semibold text-gray-900 ">
                <%= link_to p.name, edit_admin_product_path(p), class: "hover:text-(--cor-logo)" %>
              </h3>
              <!-- Description (truncated for mobile) -->
              <p class="text-sm text-gray-600 line-clamp-2 leading-tight">
                <%= truncate(p.description, length: 80) %>
              </p>
              <!-- Category and Price Row -->
              <div class="flex justify-between items-center pt-1">
                <span class="text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded-full">
                  <%= p.category.name %>
                </span>
                <span class="text-sm font-bold text-green-600">
                  R$ <%= sprintf("%.2f", p.price/100.0) %>
                </span>
              </div>
            </div>
          </div>
        <% end %>
      </div>
      <!-- Desktop Table (visible on extra large screens) -->
      <div class="admin-table-desktop hidden xl:block overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-(--cor-logo)">
            <tr>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider">
                Image
              </th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider">
                Name
              </th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider">
                Description
              </th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider">
                Category
              </th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider">
                Price
              </th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            <% @admin_products.each do |p| %>
              <tr class="hover:bg-gray-50">
                <td class="px-6 py-4 whitespace-nowrap">
                  <%= p.images.any? ? image_tag(p.images.first.variant(:thumb), class: "w-12 h-12 rounded object-cover") : image_tag("/placeholder.png", class: "w-12 h-12 rounded object-cover") %>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <%= link_to p.name, edit_admin_product_path(p), class: "text-sm font-medium text-gray-900 hover:text-(--cor-logo) hover:underline" %>
                </td>
                <td class="px-6 py-4">
                  <p class="text-sm text-gray-500 max-w-xs truncate"><%= p.description %></p>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <span class="text-sm text-gray-900"><%= p.category.name %></span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <span class="text-sm font-semibold text-green-600">R$ <%= (p.price/100.0).to_s %></span>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
      <!-- Pagination -->
      <% if @pagy.pages > 1 %>
        <div class=" py-4 border-t border-gray-200 bg-gray-50">
          <div class="flex justify-center">
            <%== pagy_nav_compact(@pagy) %>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="text-center py-12">
      <p class="text-gray-500 text-lg">No products found.</p>
      <% if params[:query].present? %>
        <p class="text-gray-400 mt-2">Try adjusting your search terms.</p>
      <% end %>
    </div>
  <% end %>
</div>
